function startGame(){game.input.keyboard.onDownCallback=null,game.state.start("level01",!0)}function findObjectsByType(e,a,t){var o=[];return a.objects[t].forEach(function(a){a.properties.type===e&&o.push(a)}),o}function createFromTiledObject(e,a){var t=a.create(e.x,e.y,e.properties.sprite);Object.keys(e.properties).forEach(function(a){t[a]=e.properties[a]})}function createBounds(e,a,t){t.enableBody=!0;var o=findObjectsByType(e,map,a);o.forEach(function(e){this.createFromTiledObject(e,t)})}function createSprites(e,a,t){var o=findObjectsByType(a,map,t);o.forEach(function(a){this.createFromTiledObject(a,e)})}function delayBreak(){return game.time.totalElapsedSeconds()>breakTime+breakDelay&&(breakTime=game.time.totalElapsedSeconds(),!0)}function interactWithPC(){"up"===direction&&game.physics.arcade.overlap(playerBounds,pcBounds,function(e,a){var t=pcBounds.getIndex(a);brokenPCs.indexOf(t)>-1?fixPC(t,"pass"):sfx.play("interact",0,volumeLevel)})}function breakPC(e){brokenPCs.push(e);var a=game.time.events.add(Phaser.Timer.SECOND*brokenPCTimeout,function(){playerLives-=1;var t=hearts.children[playerLives];t.frame=1,fixPC(e,"fail"),game.time.events.remove(a),playerLives<1&&gameOver()});brokenPCTimers.push(a),pcBounds.children[e].broken=!0,pcSprites.forEach(function(a){a.idNum===e&&(a.animations.play("pcBreak",4,!0),smoke=smokeSprites.create(a.position.x,a.position.y-16,"smoke"),smoke.animations.add("smolder",[0,1,2,3]),smoke.animations.play("smolder",4,!0),sfx.play("break",0,volumeLevel))})}function fixPC(e,a,t){t?sfx.play("powerup",0,volumeLevel):"pass"===a?sfx.play("fix",0,volumeLevel):"fail"===a&&sfx.play("bump",0,volumeLevel);var o=brokenPCs.indexOf(e);pcBounds.children[o].broken=!1,pcSprites.forEach(function(a){a.idNum===e&&a.animations.play("pcFunction",4,!0)}),smokeSprites.children[o]&&smokeSprites.children[o].destroy(),brokenPCs.splice(o,1);var r=brokenPCTimers[o],d=Math.ceil((r.tick-game.time.time)/1e3);switch(game.time.events.remove(r),brokenPCTimers.splice(o,1),breakTime=game.time.totalElapsedSeconds(),"pass"===a&&(fixedCount+=1,playerScore+=10*d,updateScore()),fixedCount){case 10:maxBroken=2;break;case 25:maxBroken=3;break;case 50:maxBroken=4;break;case 100:maxBroken=5;break;case 250:maxBroken=6;break;default:maxBroken=maxBroken}if(fixedCount>0&&fixedCount%10===0&&0===powerups.children.length&&!poweredUp){var n,s=Math.floor(3*Math.random());switch(s){case 0:n="coffee";break;case 1:n="disk";break;case 2:n="comic";break;default:n="coffee"}game.time.events.add(Phaser.Timer.SECOND*dropDelay,function(){dropPowerup(n,e)})}}function updateScore(){playerScore>999999&&(playerScore=999999);for(var e=playerScore+"";e.length<6;)e="0"+e;score.setText(e),fixedText.setText(fixedCount)}function dropPowerup(e,a){powerupLocations=[{x:16,y:56},{x:72,y:56},{x:128,y:56},{x:16,y:112},{x:72,y:112},{x:128,y:112}];for(var t=Math.floor(6*Math.random());t===a;)t=Math.floor(6*Math.random());var o=powerupLocations[t];powerup=powerups.create(o.x,o.y,e),powerup.animations.add("steam",[0,1]),powerup.animations.play("steam",4,!0),sfx.play("drop",0,volumeLevel),powerupExpire=game.time.events.add(Phaser.Timer.SECOND*powerupTimeout,function(){powerup.destroy(),sfx.play("bump",0,volumeLevel)})}function applyPowerup(e){switch(poweredUp=!0,playerScore+=25,updateScore(),game.time.events.remove(powerupExpire),e){case"coffee":runSpeed=80,abilityExpire=game.time.events.add(Phaser.Timer.SECOND*powerupTimeout,function(){poweredUp=!1,runSpeed=48,game.time.events.remove(abilityExpire)});break;case"disk":for(var a=brokenPCs.length,t=0;t<a;t++)fixPC(brokenPCs[0],"pass",!0);abilityExpire=game.time.events.add(Phaser.Timer.SECOND*powerupTimeout,function(){poweredUp=!1,game.time.events.remove(abilityExpire)});break;case"comic":playerScore+=225,updateScore(),abilityExpire=game.time.events.add(Phaser.Timer.SECOND*powerupTimeout,function(){poweredUp=!1,game.time.events.remove(abilityExpire)});break;default:return null}}function handlePause(e){e&&game.paused?game.paused=!0:game.paused=!game.paused,"pauseScreen"in window&&(pauseScreen.destroy(),pause.destroy()),game.paused&&(pauseScreen=game.add.graphics(0,0),pauseScreen.beginFill(10206223),pauseScreen.drawRect(0,0,game.world.width,game.world.height),window.graphics=pauseScreen,x=game.world.width/2,y=game.world.height/2,pause=game.add.sprite(x,y,"pause"),pause.anchor.x=.5,pause.anchor.y=.5,pauseText=game.add.bitmapText(1,0,"ITBit","Pause",16),pauseText.anchor.x=.5,pauseText.anchor.y=.5,pauseText.tint=997391,pause.addChild(pauseText))}function gameOver(){music.stop(),sfx.play("die",0,volumeLevel),game.state.start("gameOver")}var bootState={create:function(){Phaser.Canvas.setImageRenderingCrisp(game.canvas),game.world.setBounds(0,0,160,144),game.camera.roundPx=!1,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.minWidth=320,game.scale.minHeight=288,game.scale.maxWidth=320,game.scale.maxHeight=288,game.scale.refresh(),game.stage.smoothed=!1,game.renderer.renderSession.roundPixels=!0,game.state.start("load")}},loadState={preload:function(){game.load.image("title","assets/img/title.gif"),game.load.audio("sfx",["assets/sfx/sfx.mp3"]),game.load.audio("music",["assets/music/score.mp3"]),game.load.spritesheet("player","assets/img/player.gif",24,24,10),game.load.spritesheet("pcIcon","assets/img/pcIcon.gif",9,9,1),game.load.spritesheet("heart","assets/img/heart.gif",9,9,2),game.load.spritesheet("pc","assets/img/pc.gif",16,24,8),game.load.spritesheet("smoke","assets/img/smoke.gif",16,16,4),game.load.spritesheet("coffee","assets/img/coffee.gif",16,16,2),game.load.spritesheet("disk","assets/img/disk.gif",16,16,1),game.load.spritesheet("comic","assets/img/comic.gif",16,16,1),game.load.spritesheet("playerTransparent","assets/img/playerTransparent.gif",25,25,1),game.load.spritesheet("wallTransparent","assets/img/wallTransparent.gif",160,12,1),game.load.spritesheet("deskTransparent","assets/img/deskTransparent.gif",24,24,1),game.load.spritesheet("pcTransparent","assets/img/pcTransparent.gif",16,16,1),game.load.tilemap("map","assets/json/map.json",null,Phaser.Tilemap.TILED_JSON),game.load.image("floor","assets/img/floor.gif"),game.load.image("desk","assets/img/desk.gif"),game.load.bitmapFont("ITBit","assets/type/ITBit.png","assets/type/ITBit.fnt"),game.load.image("button","assets/img/button.gif"),game.load.image("pause","assets/img/pause.gif"),game.load.image("dPad","assets/img/dPad.gif"),game.load.image("dPadTransparentHorz","assets/img/dPadTransparentHorz.gif"),game.load.image("dPadTransparentVert","assets/img/dPadTransparentVert.gif"),game.load.image("btnA","assets/img/btnA.gif")},create:function(){game.state.start("title")}},neatfunState={create:function(){game.add.sprite(0,0,"neatfun"),setTimeout(function(){game.state.start("title")},1e3)}},titleState={create:function(){title=game.add.sprite(0,0,"title"),game.input.keyboard.onDownCallback=startGame,game.device.touch&&game.input.onUp.add(startGame)}};breakDelay=2,brokenPCTimeout=10,dropDelay=1,poweredUp=!1,powerupTimeout=10,runSpeed=48,volumeLevel=.5;var level01State={create:function(){game.time.reset(),againstDesk=!1,breakTime=0,brokenPCs=[],brokenPCTimers=[],direction="down",fixedCount=0,maxBroken=1,playerLives=3,playerScore=0,score=0,controls=game.input.keyboard.createCursorKeys(),fixKey=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),pauseKey=game.input.keyboard.addKey(Phaser.Keyboard.ESC),game.stage.backgroundColor="#9bbc0f",map=game.add.tilemap("map"),map.addTilesetImage("floor","floor"),map.addTilesetImage("desk","desk"),map.addTilesetImage("pc","pc"),floor=map.createLayer("floorLayer"),desk=map.createLayer("deskLayer"),powerups=game.add.group(),powerups.enableBody=!0;var e=game.world.width/2-12,a=game.world.height-32;player=game.add.sprite(e,a,"player"),game.physics.enable(player),player.body.collideWorldBounds=!0,player.animations.add("walkDown",[1,2]),player.animations.add("walkUp",[4,5]),player.animations.add("walkLeft",[7,6]),player.animations.add("walkRight",[9,8]),playerBounds=player.addChild(game.make.sprite(-1,-1,"playerTransparent")),game.physics.enable(playerBounds),wallBounds=game.add.group(),createBounds("wall","wallBounds",wallBounds),deskBounds=game.add.group(),createBounds("desk","deskBounds",deskBounds),pcBounds=game.add.group(),createBounds("pc","pcBounds",pcBounds),wallBounds.forEach(function(e){e.body.immovable=!0}),deskBounds.forEach(function(e){e.body.immovable=!0}),pcBounds.forEach(function(e){e.body.immovable=!0}),pcSprites=game.add.group(),createSprites(pcSprites,"pcSprite","pcSprites"),pcSprites.forEach(function(e){e.animations.add("pcFunction",[0,0,0,1,2,3,4,5,5,5]),e.animations.add("pcBreak",[6,7]),e.animations.play("pcFunction",4,!0)});var t=0;pcSprites.forEach(function(e){e.idNum=t,t++}),smokeSprites=game.add.group(),sfx=game.add.audio("sfx"),sfx.addMarker("break",0,.32),sfx.addMarker("drop",.32,.423),sfx.addMarker("bump",.743,.262),sfx.addMarker("fix",1.005,.27),sfx.addMarker("interact",1.275,.115),sfx.addMarker("powerup",1.391,.446),sfx.addMarker("die",1.837,.316),music=game.add.audio("music"),music.addMarker("loop",0,64,.5,!0),music.play("loop"),fixKey.onDown.add(interactWithPC),pauseKey.onDown.add(function(){handlePause(!1)}),game.onBlur.add(function(){handlePause(!0)});var o=game.add.graphics(0,0);o.beginFill(997391),o.drawRect(0,0,game.world.width,13),window.graphics=o,score=game.add.bitmapText(2,0,"ITBit",null,16),fixedIcon=game.add.sprite(game.world.width/2-6,2,"pcIcon"),fixedIcon.anchor.x=.5,fixedText=game.add.bitmapText(game.world.width/2+6,0,"ITBit",null,16),fixedText.anchor.x=.5,updateScore(),hearts=game.add.group();for(var r=0;r<playerLives;r++){var d=game.world.width-11*(playerLives-r);hearts.create(d,2,"heart")}game.device.touch&&(dPad=game.add.sprite(2,game.world.height-34,"dPad"),dPadLeft=dPad.addChild(game.add.button(0,10,"dPadTransparentHorz")),dPadLeft.onInputDown.add(function(){controls.left.isDown=!0}),dPadLeft.onInputUp.add(function(){controls.left.isDown=!1}),dPadRight=dPad.addChild(game.add.button(dPad.width-10,10,"dPadTransparentHorz")),dPadRight.onInputDown.add(function(){controls.right.isDown=!0}),dPadRight.onInputUp.add(function(){controls.right.isDown=!1}),dPadUp=dPad.addChild(game.add.button(10,0,"dPadTransparentVert")),dPadUp.onInputDown.add(function(){controls.up.isDown=!0}),dPadUp.onInputUp.add(function(){controls.up.isDown=!1}),dPadDown=dPad.addChild(game.add.button(10,dPad.height-10,"dPadTransparentVert")),dPadDown.onInputDown.add(function(){controls.down.isDown=!0}),dPadDown.onInputUp.add(function(){controls.down.isDown=!1}),btnA=game.add.button(game.world.width-24,game.world.height-24,"btnA"),btnA.onInputDown.add(function(){interactWithPC()}))},update:function(){if(player.body.velocity.x=0,player.body.velocity.y=0,game.physics.arcade.collide(player,wallBounds),game.physics.arcade.collide(player,deskBounds),game.physics.arcade.collide(player,powerups,function(e,a){a.destroy(),sfx.play("powerup",0,volumeLevel),applyPowerup(a.key)}),controls.left.isDown?(player.body.velocity.x=-runSpeed,player.animations.play("walkLeft",5,!0),direction="left"):controls.right.isDown?(player.body.velocity.x=runSpeed,player.animations.play("walkRight",5,!0),direction="right"):controls.up.isDown?(player.body.velocity.y=-runSpeed,player.animations.play("walkUp",5,!0),direction="up"):controls.down.isDown&&(player.body.velocity.y=runSpeed,player.animations.play("walkDown",5,!0),direction="down"),!(controls.left.isDown||controls.right.isDown||controls.up.isDown||controls.down.isDown))switch(direction){case"left":player.frame=6;break;case"right":player.frame=8;break;case"up":player.frame=3;break;default:player.frame=0}if(brokenPCs.length<maxBroken&&delayBreak())for(var e=[],a=0;a<maxBroken;a++)brokenPCIndex=Math.floor(6*Math.random()),e.indexOf(brokenPCIndex)<0&&brokenPCs.length<maxBroken&&brokenPCs.indexOf(brokenPCIndex)<0&&(e.push(brokenPCIndex),breakPC(brokenPCIndex))},render:function(){}};playerScore=100,fixedCount=10;var gameOverState={create:function(){for(game.stage.backgroundColor="#0f380f",msg=game.add.bitmapText(game.world.width/2,game.world.height/2,"ITBit","Game over, man.",16),msg.anchor.x=.5,msg.anchor.y=3.5,formattedScore=playerScore+"";formattedScore.length<6;)formattedScore="0"+formattedScore;for(score=game.add.bitmapText(game.world.width/2,game.world.height/2,"ITBit","Score: "+formattedScore,16),score.anchor.x=.5,score.anchor.y=2,formattedCount=fixedCount+"";formattedCount.length<6;)formattedCount="0"+formattedCount;fixed=game.add.bitmapText(game.world.width/2,game.world.height/2,"ITBit","Fixed: "+formattedCount,16),fixed.anchor.x=.5,fixed.anchor.y=1,btnX=game.world.width/2-34,btnY=game.world.height/2+10,btn=game.add.sprite(btnX,btnY,"button"),btn.inputEnabled=!0,btnText=game.add.bitmapText(btn.width/2,btn.height/2,"ITBit","Play Again",16),btnText.anchor.x=.5,btnText.anchor.y=.5,btn.addChild(btnText),btn.events.onInputDown.add(function(){game.state.start("level01",!0)})}},game=new Phaser.Game(160,144,Phaser.CANVAS,"it-worker",null,(!1),(!1));game.state.add("boot",bootState),game.state.add("load",loadState),game.state.add("neatfun",neatfunState),game.state.add("title",titleState),game.state.add("level01",level01State),game.state.add("gameOver",gameOverState),game.state.start("boot");